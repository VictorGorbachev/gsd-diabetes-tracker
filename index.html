<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>GSD Tracker</title>
    <link rel="stylesheet" href="src/styles/variables.css">
    <link rel="stylesheet" href="src/styles/main.css">
</head>
<body>
    <div class="container">
        <form id="gsdForm" class="form">
            <div class="heading-block-form">
                <div class="heading-form">
                    <h2>Дневник сахара</h2>
                    <p>Анна Шведюк</p>                    
                </div>
                <svg class="settings-icon" width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                    <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1m15.5-3.5L19 8.5m-14 7L7.5 13m7-7L16 7.5m-8 8L6.5 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            
            <!-- Дата и время -->
            <div class="form-row">
                <div class="input-group">
                    <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                        <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2"/>
                        <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2"/>
                        <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <input type="date" id="date" required>
                </div>
                <div class="input-group">
                    <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <circle cx="12" cy="13" r="8" stroke="currentColor" stroke-width="2"/>
                        <path d="M12 9l0 4l3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <path d="M17 6l1.5-1.5" stroke="currentColor" stroke-width="2"/>
                        <path d="M6.5 4.5L8 6" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <input type="time" id="time" required>
                </div>
            </div>

            <!-- Сахар -->
            <div class="form-row single">
                <div class="input-group full-width">
                    <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path d="M7.5 8A5.5 5.5 0 0 1 13 2.5c2.8 0 5.2 2.2 5.5 5a5.5 5.5 0 0 1-5 5.5 5.5 5.5 0 0 1-5.5-5z" stroke="currentColor" stroke-width="2"/>
                        <path d="M16.5 16A5.5 5.5 0 0 1 11 21.5c-2.8 0-5.2-2.2-5.5-5a5.5 5.5 0 0 1 5-5.5 5.5 5.5 0 0 1 5.5 5z" stroke="currentColor" stroke-width="2"/>
                        <circle cx="12" cy="12" r="1" fill="currentColor"/>
                    </svg>
                    <input type="number" id="sugar" step="0.1" placeholder="Сахар">
                </div>
            </div>

            <!-- Инсулин -->
            <div class="form-row single">
                <div class="input-group full-width">
                    <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <rect x="9" y="2" width="6" height="20" rx="3" ry="3" stroke="currentColor" stroke-width="2"/>
                        <rect x="7" y="6" width="10" height="2" rx="1" ry="1" stroke="currentColor" stroke-width="2"/>
                        <rect x="7" y="16" width="10" height="2" rx="1" ry="1" stroke="currentColor" stroke-width="2"/>
                        <circle cx="12" cy="12" r="2" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <div class="insulin-group">
                        <select class="insulin-select" id="insulin">
                            <option value="">Нет</option>
                            <option value="novorapid" selected>Новорапид</option>
                            <option value="levemir">Левемир</option>
                        </select>
                        <div id="insulinUnits" class="insulin-units" style="display: flex;">
                            <button type="button" class="units-btn" id="decreaseUnits">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2"/>
                                </svg>
                            </button>
                            <span id="unitsValue">8</span>
                            <button type="button" class="units-btn" id="increaseUnits">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <line x1="12" y1="5" x2="12" y2="19" stroke="currentColor" stroke-width="2"/>
                                    <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Еда -->
            <div class="form-row single">
                <div class="input-group food-group full-width">
                    <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7z" stroke="currentColor" stroke-width="2"/>
                        <path d="M12 5c1.5 0 3 .5 4 1.5L12 12l-4-5.5C9 5.5 10.5 5 12 5z" stroke="currentColor" stroke-width="2"/>
                        <path d="M8 12c0 2.2 1.8 4 4 4s4-1.8 4-4" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <div class="food-row">
                        <textarea id="food" placeholder="Еда"></textarea>
                        <div id="chipsContainer" class="chips-container" style="display: none;"></div>
                        <div id="breadUnits" class="bread-units">
                            <button type="button" class="units-btn" id="decreaseBreadUnits">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2"/>
                                </svg>
                            </button>
                            <span id="breadUnitsValue">1.0</span>
                            <button type="button" class="units-btn" id="increaseBreadUnits">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <line x1="12" y1="5" x2="12" y2="19" stroke="currentColor" stroke-width="2"/>
                                    <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2"/>
                                </svg>
                            </button>
                        </div>                        
                    </div>
                </div>
            </div>

            <button type="submit" class="submit-btn">Добавить</button>
        </form>

        <div id="flowersBlock" class="flowers-block" style="display:none"></div>
        <div id="emptyEntriesStub" class="empty-entries-stub" style="display: block;">
            <img src="img/first-note.png" alt="Первая запись" class="modal-img">
            <div class="empty-entries-text">
                <h2 class="empty-entries-title">Добавьте первую запись</h2>
                <div class="text-descriptor empty-entries-desc">У вас пока нет ни одной записи.<br>Заполните форму, чтобы добавить первую.</div>
            </div>
        </div>
        <div id="entries" class="entries"></div>
    </div>

    <!-- Модальные окна -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <h3>Удалить запись?</h3>
            <p>Вы уверены, что хотите удалить эту запись? Это действие нельзя отменить.</p>
            <div class="modal-buttons">
                <button id="cancelDelete" class="modal-btn cancel">Отмена</button>
                <button id="confirmDelete" class="modal-btn confirm">Удалить</button>
            </div>
        </div>
    </div>

    <div id="importConfirmModal" class="modal">
        <div class="modal-content" style="text-align:center;">
            <img class="modal-img" src="img/working-with-data.png" alt="Импорт данных">
            <h3>Импорт данных</h3>
            <div class="modal-buttons">
                <button id="cancelImport" class="modal-btn cancel">Отменить</button>
                <button id="confirmImport" class="modal-btn black">Импортировать</button>
            </div>
            <div class="text-descriptor">Импорт заменит все текущие записи. Старые данные будут удалены без возможности восстановления. Продолжить?</div>
        </div>
    </div>

    <div id="entryActionsModal" class="modal">
        <div class="modal-content">
            <h3>Что сделать с записью?</h3>
            <div class="modal-buttons">
                <button id="deleteEntryBtn" class="modal-btn confirm">Удалить</button>
                <span class="modal-text">Удалить запись навсегда без возможности восстановления</span>                
                <button id="editEntryBtn" class="modal-btn black">Редактировать</button>
                <span class="modal-text">Отредактировать запись: она исчезнет из списка, но все данные заполнятся в форму</span>
                <button id="cancelEntryActionBtn" class="modal-btn cancel">Отмена</button>
            </div>
        </div>
    </div>

    <div id="rewardModal" class="modal">
        <div class="modal-content reward-modal-content">
            <div class="reward-text">Ура! За вчерашний день у тебя не было ни одного вылета!<br>Так держать!</div>
            <button id="closeRewardBtn" class="modal-btn black">УРА!</button>
        </div>
    </div>

    <div id="editEntryModal" class="modal">
        <div class="modal-content">
            <form id="editEntryForm" class="form form-edit">
                <div class="form-row">
                    <div class="input-group">
                        <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                            <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2"/>
                            <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2"/>
                            <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <input type="date" id="editDate" required>
                    </div>
                    <div class="input-group">
                        <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <circle cx="12" cy="13" r="8" stroke="currentColor" stroke-width="2"/>
                            <path d="M12 9l0 4l3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <input type="time" id="editTime" required>
                    </div>
                </div>
                <div class="form-row single">
                    <div class="input-group full-width">
                        <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M7.5 8A5.5 5.5 0 0 1 13 2.5c2.8 0 5.2 2.2 5.5 5a5.5 5.5 0 0 1-5 5.5 5.5 5.5 0 0 1-5.5-5z" stroke="currentColor" stroke-width="2"/>
                            <path d="M16.5 16A5.5 5.5 0 0 1 11 21.5c-2.8 0-5.2-2.2-5.5-5a5.5 5.5 0 0 1 5-5.5 5.5 5.5 0 0 1 5.5 5z" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <input type="number" id="editSugar" step="0.1" placeholder="Сахар">
                    </div>
                </div>
                <div class="form-row single">
                    <div class="input-group full-width">
                        <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <rect x="9" y="2" width="6" height="20" rx="3" ry="3" stroke="currentColor" stroke-width="2"/>
                            <rect x="7" y="6" width="10" height="2" rx="1" ry="1" stroke="currentColor" stroke-width="2"/>
                            <circle cx="12" cy="12" r="2" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <div class="insulin-group">
                            <select class="insulin-select" id="editInsulin">
                                <option value="">Нет</option>
                                <option value="novorapid">Новорапид</option>
                                <option value="levemir">Левемир</option>
                            </select>
                            <div id="editInsulinUnits" class="insulin-units">
                                <button type="button" class="units-btn" id="editDecreaseUnits">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                        <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2"/>
                                    </svg>
                                </button>
                                <span id="editUnitsValue">5</span>
                                <button type="button" class="units-btn" id="editIncreaseUnits">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                        <line x1="12" y1="5" x2="12" y2="19" stroke="currentColor" stroke-width="2"/>
                                        <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-row single">
                    <div class="input-group food-group full-width">
                        <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7z" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <div class="food-row">
                            <textarea id="editFood" placeholder="Еда"></textarea>
                            <div id="editBreadUnits" class="bread-units">
                                <button type="button" class="units-btn" id="editDecreaseBreadUnits">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                        <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2"/>
                                    </svg>
                                </button>
                                <span id="editBreadUnitsValue">1.0</span>
                                <button type="button" class="units-btn" id="editIncreaseBreadUnits">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                        <line x1="12" y1="5" x2="12" y2="19" stroke="currentColor" stroke-width="2"/>
                                        <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-buttons">
                    <button id="editDeleteBtn" type="button" class="modal-btn delete">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <polyline points="3,6 5,6 21,6" stroke="currentColor" stroke-width="2"/>
                            <path d="M19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2" stroke="currentColor" stroke-width="2"/>
                            <line x1="10" y1="11" x2="10" y2="17" stroke="currentColor" stroke-width="2"/>
                            <line x1="14" y1="11" x2="14" y2="17" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </button>
                    <button id="editSaveBtn" type="submit" class="modal-btn black">Редактировать</button>
                </div>
            </form>
        </div>
    </div>

    <div id="confirmDeleteEntryModal" class="modal">
        <div class="modal-content" style="text-align:center;">
            <img src="img/delete-an-entry.png" alt="Удалить запись" class="modal-img">
            <h3>Удалить запись?</h3>
            <div class="modal-buttons" style="justify-content:center;">
                <button id="cancelDeleteEntryBtn" class="modal-btn cancel">Отменить</button>
                <button id="confirmDeleteEntryBtn" class="modal-btn confirm">Удалить</button>
            </div>
            <div class="text-descriptor">При удалении этой записи она будет<br>безвозвратно удалена</div>
        </div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-content" style="text-align:center;">
            <img class="modal-img" src="img/working-with-data.png" alt="Работа с данными">
            <h3>Работа с данными</h3>
            <div class="modal-buttons">
                <button id="exportBtn" class="modal-btn action-btn">Экспорт данных</button>
                <button id="importBtn" class="modal-btn action-btn">Импорт данных</button>
            </div>
            <div class="text-descriptor">Хранение данных важно для сохранения ценной информации, обеспечения безопасности и возможности быстрого восстановления в случае сбоев.</div>
        </div>
    </div>

    <!-- Баннеры -->
    <div id="importSuccessBanner" class="banner-success" style="display:none;">Данные успешно импортированы!</div>
    <div id="editSuccessBanner" class="banner-success" style="display:none;">Изменения успешно сохранены!</div>
    <div id="deleteSuccessBanner" class="banner-success" style="display:none;">Запись удалена успешно</div>

    <!-- Скрипты -->
    <script src="https://unpkg.com/airtable/build/airtable.browser.js"></script>
    <script src="src/utils/dateUtils.js"></script>
    <script src="src/utils/validation.js"></script>
    <script src="src/utils/storage.js"></script>
    <script src="src/utils/airtableSync.js"></script>
    <script src="src/components/Entry.js"></script>
    <script src="src/components/DayCard.js"></script>
    <script src="src/main.js"></script>
</body>
</html>